分布式系统协调方法论
1. 分布式系统带来的问题
    1) 通信异常
    2) 网络分区
    3) 三态(成功,失败,超时)
    4) 节点故障
2. CAP理论(只能三选二)----> (架构师的精力往往就花在怎么样根据业务场景在一致性和可用性之间寻求平衡)
    1) 强一致性
    2) 高可用性
    3) 分区容错性(脑裂?)
3. BASE理论
    1) 基本可用:当系统出现不可预见的故障时,允许部分功能不可用,保障系统的基本可用;
    2) 软状态:允许系统中的数据存在中间状态,即系统的不同节点的数据副本之前的数据同步过程存在的延时,并认为这种延时不会影响到系统可用性
    3) 最终一致性:所有的数据在经过一段时间的数据同步后,最终能达到一个一致的状态
4.分布式环境协调和通信到底有什么场景
    1) 数据发布订阅
    2) 负载均衡
    3) 命名服务(生成订单ID)
    4) master选举
    5) 集群管理(服务注册与发现)
    6) 配置管理
    7) 分布式队列
    8) 分布式锁

服务雪崩
服务隔离(接口之间不能影响)
服务熔断(短时间内不能访问)
服务降级()
服务限流()


zookeeper是一个树形的数据结构

每个节点都必须有值

节点又分为持久节点(连接断开后数据节点还存在)和临时节点(连接断开后数据节点被删除)
同样节点也分为顺序节点和无顺序节点, 这四种节点组合就分为4种节点

节点类型
1.持久节点
2.顺序持久节点
3.临时节点
4.顺序临时节点

创建持久节点(不能重复, 没有顺序)
create /node a
创建顺序持久节点(允许重复, 有顺序)
create -s /node1 a
创建临时节点(不能重复, 没有顺序)
create -e /node2 a
创建顺序临时节点(允许重复, 有顺序)
create -e -s /node2 a

NOTE: 顺序节点重复,否则不能

set更新命令


cap
一致性
高可用
分区容错性
base理论, 基本可用,最终一致性

分布式事务(tcc)

1. 一致性协议

    两阶段提交(2PC)
        优点: 原理简单,实现方便
        缺点: 同步阻塞,单点故障,数据不一致,容错机制不完善
    三阶段提交(3PC)
        优点: 改善同步阻塞,改善单点故障
        缺点: 同步阻塞,单点故障,数据不一致,容错机制不完善
        
2. zk集群解析
    特点:
        1) 顺序一致性
        2) 原子性
        3) 单一视图
        4) 可靠性
        5) 实时性
        6) 角色轮换避免单点故障
    角色:
        leader -> 任务调度,事务处理
        follower -> 处理非事务请求(读请求),参与投票
        observer -> 读请求,不参与投票(3.3版本以上)
    
    集群配置zoo.conf
        server.0=192.168.1.210:2888:3888   
        server.1=192.168.1.211:2888:3888   
        server.2=192.168.1.212:2888:3888   
        在data目录增加一个文件名为"myid"内容为<0/1/2>跟上面配置的ID是一样的
        peeType=observer
        server.3=192.168.1.213:2888:3888:observer
           
    zab其实就是paxos的一种实现分布式数据一致性问题
    消息广播,数据同步,崩溃恢复
    
    负载算法:hash,轮询,随机
    
    服务注册与发现
    首先要将服务的ip/port注册到中间件,然后其它服务获取这些服务的ip/port从中间件获取下来
    
    
    zookeeper实现分布式锁有两种方式:
        1. 所有监听同一个路径
        2. 排队监听,下一个节点只关注前面那个节点的锁释放就可以,不需要通知到各个节点获取锁,导致资源浪费
    
    
    
    
    
3. 应用场景








